From 05db95f4427f9adb1f40b23dd8e10b6c19d6fb4a Mon Sep 17 00:00:00 2001
From: cyan <cyjan@mrcyjanek.net>
Date: Sun, 3 Nov 2024 08:15:28 +0000
Subject: [PATCH 1/2] wip fixes for macos

---
 contrib/depends/packages/boost.mk             |  2 +-
 contrib/depends/packages/darwin_sdk.mk        |  7 +++++++
 .../patches/darwin_sdk/fix_definitions.patch  | 21 +++++++++++++++++++
 3 files changed, 29 insertions(+), 1 deletion(-)
 create mode 100644 contrib/depends/patches/darwin_sdk/fix_definitions.patch

diff --git a/contrib/depends/packages/boost.mk b/contrib/depends/packages/boost.mk
index d60bfa74..2fae4c94 100644
--- a/contrib/depends/packages/boost.mk
+++ b/contrib/depends/packages/boost.mk
@@ -8,7 +8,7 @@ $(package)_patches=fix_aroptions.patch fix_arm_arch.patch fix_pthread_win.patch
 
 define $(package)_set_vars
 $(package)_config_opts_release=variant=release
-$(package)_config_opts_debug=variant=debug
+$(package)_config_opts_debug=variant=release
 $(package)_config_opts=--layout=system --user-config=user-config.jam
 $(package)_config_opts+=threading=multi link=static -sNO_BZIP2=1 -sNO_ZLIB=1
 $(package)_config_opts_linux=threadapi=pthread runtime-link=static
diff --git a/contrib/depends/packages/darwin_sdk.mk b/contrib/depends/packages/darwin_sdk.mk
index d639c422..da510e08 100644
--- a/contrib/depends/packages/darwin_sdk.mk
+++ b/contrib/depends/packages/darwin_sdk.mk
@@ -3,8 +3,15 @@ $(package)_version=11.1
 $(package)_download_path=https://github.com/phracker/MacOSX-SDKs/releases/download/11.3/
 $(package)_file_name=MacOSX$($(package)_version).sdk.tar.xz
 $(package)_sha256_hash=68797baaacb52f56f713400de306a58a7ca00b05c3dc6d58f0a8283bcac721f8
+$(package)_patches=fix_definitions.patch
 
 define $(package)_stage_cmds
   mkdir -p $($(package)_staging_dir)/$(host_prefix)/native/SDK &&\
   mv * $($(package)_staging_dir)/$(host_prefix)/native/SDK
 endef
+
+
+define $(package)_preprocess_cmds
+  pwd &&\
+  patch -p1 < $($(package)_patch_dir)/fix_definitions.patch
+endef
\ No newline at end of file
diff --git a/contrib/depends/patches/darwin_sdk/fix_definitions.patch b/contrib/depends/patches/darwin_sdk/fix_definitions.patch
new file mode 100644
index 00000000..5409ee15
--- /dev/null
+++ b/contrib/depends/patches/darwin_sdk/fix_definitions.patch
@@ -0,0 +1,21 @@
+--- ./usr/include/sys/sysctl.h.0  2024-11-03 07:59:31.870270093 +0000
++++ ./usr/include/sys/sysctl.h    2024-11-03 08:00:38.698271564 +0000
+@@ -70,6 +70,18 @@
+  * Version 2.0.
+  */
+ 
++#ifndef u_int
++typedef unsigned int u_int;
++#endif
++
++#ifndef u_char
++typedef unsigned char u_char;
++#endif
++
++#ifndef u_short
++typedef unsigned short u_short;
++#endif
++
+ #ifndef _SYS_SYSCTL_H_
+ #define _SYS_SYSCTL_H_
+ 
\ No newline at end of file
-- 
2.43.0

